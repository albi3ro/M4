<!DOCTYPE html>
<html>


  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Jacobi Transformation of a Symmetric Matrix</title>
    <!-- <meta name="description" content="Blog Introduction to Computational Condensed Matter Physics"> -->
    <link rel="stylesheet" href="/M4/css/main.css">
    <link rel="canonical" href="http://localhost:4000/M4/Jacobi-Transformation.html">
    <meta name="google-site-verification" content="FLWeXTRDBUYGSJXcdiUyqbwExBElCj76l3EdhtLL-wI" />
          <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
      inlineMath: [ ['$','$'], ['\(', '\)'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true,
    }
  });
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


    <meta property="og:title" content="Jacobi Transformation of a Symmetric Matrix" />
    <meta property="og:image" content="" />
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@PyrochloreLee" />
    <meta property="twitter:title" content="Jacobi Transformation of a Symmetric Matrix" />
    <meta property="twitter:image" content="" />
    <meta property="twitter:description" content="" />

    <link rel="apple-touch-icon" sizes="180x180" href="/M4/Images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/M4/Images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/M4/Images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/M4/Images/favicons/manifest.json">
    <link rel="mask-icon" href="/M4/Images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#000000">

</head>


  <body>


    <header class="site-header">

  <div>

    <a class="site-title" href="/M4/">Metals, Magnets, and Miscellaneous Materials</a>

    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" style="float: right">
    <input type="hidden" name="cmd" value="_donations">
    <input type="hidden" name="business" value="chrissie.c.l@gmail.com">
    <input type="hidden" name="lc" value="US">
    <input type="hidden" name="item_name" value="M4">
    <input type="hidden" name="no_note" value="0">
    <input type="hidden" name="currency_code" value="USD">
    <input type="hidden" name="bn" value="PP-DonationsBF:btn_donate_SM.gif:NonHostedGuest">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>



  </div>

</header>




    <div class="page-content">
        <div class="downloadzp"><a href="https://github.com/albi3ro/M4/archive/master.zip" class="sidebar">Zip!</a></div>

        <div class="clonelink"><a href="https://github.com/albi3ro/M4.git" class="sidebar">Clone!</a></div>

        <div class="pdfslink"><a href="/M4/pdfs" class="sidebar">PDFs</a></div>

        <div class="juliadocs"><a href="https://docs.julialang.org/" class="sidebar">Docs</a></div>

        <div class="juliahelp"><a href="/M4/jupyterjulia" class="sidebar">Interact</a></div>

        <div class="about"><a href="/M4/about" class="sidebar">About</a></div>

      <div class="wrapper">
        <div class="post">
<meta name="description" content="" />
<meta name="keywords" content="ED" />
<meta name="author" content="Christina C. Lee" />

  <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  <header class="post-header">
    <h1 class="post-title" itemprop="name">Jacobi Transformation of a Symmetric Matrix</h1>
    <p class="post-meta">Author: Christina C. Lee &nbsp;&nbsp;&nbsp;&nbsp;
      Category: <a href="/M4/categories">
        Numerics</a> &nbsp;  &nbsp; &nbsp; &nbsp;
        Tags:
      
      <a href="/M4/tags#ED">ED</a>&nbsp; 
        </p>
  </header>

  <article class="post-content">

    <p><i>Based on Numerical Recipes in C++, Sec 11.1</i></p>

<p>So you want to diagonalize a matrix, do you?
Well, if you have a tiny symmetric matrix, you REALLY want to write up the algorithm by hand, and don’t want to spend much time trying to understand the algorithm, then you have come to the right place.</p>

<p>Otherwise, use LAPACK/BLAS to call a highly optimized routine that can work extremely quickly on large matrices. Julia has those libraries built in already. Even if you do call those matrices, you can make them work better by understanding what’s going on underneath the hood, which is why we are going through this now.</p>

<p>Start with a base <i>rotation matrix</i> of the Form
<script type="math/tex">% <![CDATA[
P_{pq} =
    \begin{pmatrix}
           1& &  &  & & & & 0 \\
           & \ddots & & & &  &  \\
            & & c & \cdots & s & & \\
                & &\vdots& 1 & \vdots & & \\
               & & -s & \cdots & c & &  \\
               & & & & & \ddots &  \\
               0 & & & &  & & 1\\
    \end{pmatrix} %]]></script></p>

<p>From our starting arbitrary symmetric <script type="math/tex">A</script>,</p>

<script type="math/tex; mode=display">A^T = A</script>

<p>we will run a series of transformations,</p>

<script type="math/tex; mode=display">A^{\prime}= P^{T}\_{pq} \cdot A \cdot P\_{pq}</script>

<p>where each iteration brings <script type="math/tex">A</script> closer to diagonal form.  Thus in our implementing our algorithm, we need to determine two things</p>

<ul>
  <li>The values of <script type="math/tex">c</script> and <script type="math/tex">s</script></li>
  <li>The pattern of sweeping <script type="math/tex">p</script> and <script type="math/tex">q</script></li>
</ul>

<p>And in the end we will need to finally determine if this actually converges, and if has any sort of efficiency.</p>

<p>So lets expand one transformation, and we if we can solve for $c$ and $s$.</p>

<script type="math/tex; mode=display">a^{\prime}_{rp}  = c a_{rp} - s a_{rq}</script>

<script type="math/tex; mode=display">a^{\prime}_{rq}  = c a_{rq} + s a_{rp}</script>

<script type="math/tex; mode=display">a^{\prime}_{pp}  = c^2 a_{pp} + s^2 a_{qq} -2 sc a_{pq}</script>

<script type="math/tex; mode=display">a^{\prime}_{qq}  = s^2 a_{qq} + c^2 a_{qq} + 2sc a_{pq}</script>

<script type="math/tex; mode=display">a^{\prime}_{pq}  = \left( c^2-s^2 \right) a_{pq} + sc \left(a_{pq} - a_{qq} \right)</script>

<h2 id="determining-s-and-c">Determining $s$ and $c$</h2>
<p>Given we specifically want $a^{\prime}_{pq}$ to be zero, we re-arrange the last equation,</p>

<script type="math/tex; mode=display">\frac{c^2-s^2}{2 sc} = \frac{a_{pq}-a_{qq}}{2 a_{pq}} = \theta</script>

<p>At first glance, this equation might not look easier to solve for $s$ or $c$.  At second glance either. We define a new parameter $t = s/c$, which now makes the equation,</p>

<script type="math/tex; mode=display">\frac{1-t^2}{2 t} = \theta \;\;\;\; \implies \;\;\; t^2 -2 \theta t -1=0,</script>

<p>now quite easily solvable by our friendly quadratic formula.  Though the book does recommend using a form that pulls out smaller roots through</p>

<script type="math/tex; mode=display">t=\frac{\text{sgn}( \theta )}{| \theta | + \sqrt{ \theta ^2 + 1} }.</script>

<p>Then reverse solve back to</p>

<script type="math/tex; mode=display">c=\frac{1}{\sqrt{t^2+1}} \;\;\; s=tc</script>

<p>Though we could use the expressions above, if we simplify them with our new expressions for $c$ and $s$ analytically, we reduce computational load and round off error. These new expressions are</p>

<script type="math/tex; mode=display">a^{\prime}_{pq}  = 0</script>

<script type="math/tex; mode=display">a^{\prime}_{qq}  = a_{qq} + t a_{qp}</script>

<script type="math/tex; mode=display">a^{\prime}_{pp} = a_{pp} - t a_{pq}</script>

<script type="math/tex; mode=display">a^{\prime}_{rp} = a_{rp} - s \left( a_{rq} +\tau a_{rp} \right)</script>

<script type="math/tex; mode=display">a^{\prime}_{rq} = a_{rq} + s \left( a_{rp} -\tau a_{rq} \right)</script>

<p>with the new variable</p>

<script type="math/tex; mode=display">\tau = \frac{s}{1+c}</script>

<h2 id="convergence">Convergence</h2>

<p>The sum of the squares of the off diagonal elements, choosen in either upper or lower triangles arbitrarily,</p>

<script type="math/tex; mode=display">% <![CDATA[
S=\sum\limits_{r < s} |a_{rs}|^2 %]]></script>

<h2 id="eigenvectors">Eigenvectors</h2>

<p>By forming a product of every rotation matrix, we also come to approximate the matrix $V$ where</p>

<script type="math/tex; mode=display">D = V^{T} \cdot A \cdot V</script>

<p>and $D$ is the diagonal form of $A$.  $V$ is computed through iterative computation</p>

<script type="math/tex; mode=display">V^{\prime} = V \cdot P_i</script>

<script type="math/tex; mode=display">v^{\prime}_{rs} = v_{rs}</script>

<script type="math/tex; mode=display">v^{\prime}_{rp} = c v_{rp} - s v_{rq}</script>

<script type="math/tex; mode=display">v^{\prime}_{rq} = s v_{rp} + c v_{rq}</script>

<h3 id="enough-with-the-talking-lets-compute-stuff">Enough with the talking! LETS COMPUTE STUFF</h3>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">LinearAlgebra</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="c"># First, Lets make our nice, helpful functions</span>

<span class="c">## A function to look at the convergence</span>
<span class="k">function</span><span class="nf"> convergence</span><span class="x">(</span><span class="n">A</span><span class="o">::</span><span class="n">Array</span><span class="x">)</span>
    <span class="n">num</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">l</span><span class="o">=</span><span class="n">size</span><span class="x">(</span><span class="n">A</span><span class="x">)[</span><span class="mi">1</span><span class="x">]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="x">)</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="k">in</span> <span class="x">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="x">):</span><span class="n">l</span> <span class="c">## just looking at the lower triangle</span>
            <span class="n">num</span><span class="o">+=</span><span class="n">A</span><span class="x">[</span><span class="n">ii</span><span class="x">,</span><span class="n">jj</span><span class="x">]</span><span class="o">^</span><span class="mi">2</span>
            <span class="c">#println(ii,' ',jj,' ',num,' ',A[ii,jj])</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">num</span>
<span class="k">end</span></code></pre></figure>

<p>This makes a matrix easier to look at than when its filled
with 1.043848974e-12 everywhere</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="c"># This makes a matrix easier to look at when its filled </span>
<span class="c"># with 1.043848974e-12 everywhere</span>
<span class="k">function</span><span class="nf"> roundmatrix</span><span class="x">(</span><span class="n">A</span><span class="o">::</span><span class="n">Array</span><span class="x">,</span><span class="n">rtol</span><span class="o">::</span><span class="n">Real</span><span class="x">)</span>
    <span class="n">Ap</span><span class="o">=</span><span class="n">copy</span><span class="x">(</span><span class="n">A</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">length</span><span class="x">(</span><span class="n">A</span><span class="x">)</span>
        <span class="k">if</span> <span class="n">abs</span><span class="x">(</span><span class="n">Ap</span><span class="x">[</span><span class="n">ii</span><span class="x">])</span><span class="o">&lt;</span><span class="n">rtol</span> 
            <span class="n">Ap</span><span class="x">[</span><span class="n">ii</span><span class="x">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">Ap</span><span class="x">;</span>
<span class="k">end</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="c">## Here we create a random symmetric matrix</span>
<span class="k">function</span><span class="nf"> makeA</span><span class="x">(</span><span class="n">n</span><span class="x">)</span>
    <span class="n">A</span><span class="o">=</span><span class="n">randn</span><span class="x">(</span><span class="n">n</span><span class="x">,</span><span class="n">n</span><span class="x">);</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">n</span>
        <span class="n">A</span><span class="x">[</span><span class="n">ii</span><span class="x">,</span><span class="mi">1</span><span class="x">:</span><span class="n">ii</span><span class="x">]</span><span class="o">=</span><span class="n">transpose</span><span class="x">(</span><span class="n">A</span><span class="x">[</span><span class="mi">1</span><span class="x">:</span><span class="n">ii</span><span class="x">,</span><span class="n">ii</span><span class="x">])</span> 
    <span class="k">end</span>
    <span class="n">V</span><span class="o">=</span><span class="n">Matrix</span><span class="x">{</span><span class="kt">Float64</span><span class="x">}(</span><span class="n">I</span><span class="x">,</span><span class="n">n</span><span class="x">,</span><span class="n">n</span><span class="x">)</span> <span class="c">#initializing the orthogonal transformation</span>
    <span class="k">return</span> <span class="n">A</span><span class="x">,</span><span class="n">copy</span><span class="x">(</span><span class="n">A</span><span class="x">),</span><span class="n">V</span>
<span class="k">end</span>
<span class="c">## One A returned will be stored to compare initial and final</span></code></pre></figure>

<p>Now on to the rotations!</p>

<p>We don’t always want to compute the eigenvectors, so those are in the optional entries slot.
Both tell the function to compute the vectors with <code class="highlighter-rouge">computeV=true</code>
and input the <code class="highlighter-rouge">V=V</code> after the semicolon.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> Rotate</span><span class="x">(</span><span class="n">A</span><span class="o">::</span><span class="n">Array</span><span class="x">,</span><span class="n">p</span><span class="o">::</span><span class="kt">Int</span><span class="x">,</span><span class="n">q</span><span class="o">::</span><span class="kt">Int</span><span class="x">;</span> <span class="n">computeV</span><span class="o">=</span><span class="n">false</span><span class="x">,</span> <span class="n">V</span><span class="o">::</span><span class="n">Array</span><span class="o">=</span><span class="n">Matrix</span><span class="x">{</span><span class="kt">Float64</span><span class="x">}(</span><span class="n">I</span><span class="x">,</span><span class="mi">1</span><span class="x">,</span><span class="mi">1</span><span class="x">)</span> <span class="x">)</span>
    <span class="n">θ</span><span class="o">=</span><span class="x">(</span><span class="n">A</span><span class="x">[</span><span class="n">q</span><span class="x">,</span><span class="n">q</span><span class="x">]</span><span class="o">-</span><span class="n">A</span><span class="x">[</span><span class="n">p</span><span class="x">,</span><span class="n">p</span><span class="x">])</span><span class="o">/</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="x">[</span><span class="n">p</span><span class="x">,</span><span class="n">q</span><span class="x">]);</span>
    <span class="n">t</span><span class="o">=</span><span class="n">sign</span><span class="x">(</span><span class="n">θ</span><span class="x">)</span><span class="o">/</span><span class="x">(</span><span class="n">abs</span><span class="x">(</span><span class="n">θ</span><span class="x">)</span><span class="o">+</span><span class="n">sqrt</span><span class="x">(</span><span class="n">θ</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="x">));</span>
    
    <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="x">)</span>
    <span class="n">s</span><span class="o">=</span><span class="n">t</span><span class="o">*</span><span class="n">c</span>
    <span class="n">τ</span><span class="o">=</span><span class="n">s</span><span class="o">/</span><span class="x">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="x">)</span>
    
    <span class="n">l</span><span class="o">=</span><span class="n">size</span><span class="x">(</span><span class="n">A</span><span class="x">)[</span><span class="mi">1</span><span class="x">]</span>
    <span class="n">Ap</span><span class="o">=</span><span class="n">copy</span><span class="x">(</span><span class="n">A</span><span class="x">[:,</span><span class="n">p</span><span class="x">])</span>
    <span class="n">Aq</span><span class="o">=</span><span class="n">copy</span><span class="x">(</span><span class="n">A</span><span class="x">[:,</span><span class="n">q</span><span class="x">])</span>
    <span class="k">for</span> <span class="n">r</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">l</span>
        <span class="n">A</span><span class="x">[</span><span class="n">r</span><span class="x">,</span><span class="n">p</span><span class="x">]</span><span class="o">=</span><span class="n">Ap</span><span class="x">[</span><span class="n">r</span><span class="x">]</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="x">(</span><span class="n">Aq</span><span class="x">[</span><span class="n">r</span><span class="x">]</span><span class="o">+</span><span class="n">τ</span><span class="o">*</span><span class="n">Ap</span><span class="x">[</span><span class="n">r</span><span class="x">])</span> 
        <span class="n">A</span><span class="x">[</span><span class="n">r</span><span class="x">,</span><span class="n">q</span><span class="x">]</span><span class="o">=</span><span class="n">Aq</span><span class="x">[</span><span class="n">r</span><span class="x">]</span><span class="o">+</span><span class="n">s</span><span class="o">*</span><span class="x">(</span><span class="n">Ap</span><span class="x">[</span><span class="n">r</span><span class="x">]</span><span class="o">-</span><span class="n">τ</span><span class="o">*</span><span class="n">Aq</span><span class="x">[</span><span class="n">r</span><span class="x">])</span>
        
        <span class="n">A</span><span class="x">[</span><span class="n">p</span><span class="x">,</span><span class="n">r</span><span class="x">]</span><span class="o">=</span><span class="n">A</span><span class="x">[</span><span class="n">r</span><span class="x">,</span><span class="n">p</span><span class="x">]</span>
        <span class="n">A</span><span class="x">[</span><span class="n">q</span><span class="x">,</span><span class="n">r</span><span class="x">]</span><span class="o">=</span><span class="n">A</span><span class="x">[</span><span class="n">r</span><span class="x">,</span><span class="n">q</span><span class="x">]</span>
    <span class="k">end</span>
    <span class="n">A</span><span class="x">[</span><span class="n">p</span><span class="x">,</span><span class="n">q</span><span class="x">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">A</span><span class="x">[</span><span class="n">q</span><span class="x">,</span><span class="n">p</span><span class="x">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">A</span><span class="x">[</span><span class="n">p</span><span class="x">,</span><span class="n">p</span><span class="x">]</span><span class="o">=</span><span class="n">Ap</span><span class="x">[</span><span class="n">p</span><span class="x">]</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">Aq</span><span class="x">[</span><span class="n">p</span><span class="x">]</span>
    <span class="n">A</span><span class="x">[</span><span class="n">q</span><span class="x">,</span><span class="n">q</span><span class="x">]</span><span class="o">=</span><span class="n">Aq</span><span class="x">[</span><span class="n">q</span><span class="x">]</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">Aq</span><span class="x">[</span><span class="n">p</span><span class="x">]</span>
    
    <span class="k">if</span> <span class="n">computeV</span><span class="o">==</span><span class="n">true</span>
        <span class="n">Vp</span><span class="o">=</span><span class="n">copy</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span><span class="n">p</span><span class="x">])</span>
        <span class="n">Vq</span><span class="o">=</span><span class="n">copy</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span><span class="n">q</span><span class="x">])</span>    
        <span class="k">for</span> <span class="n">r</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">l</span>   
            <span class="n">V</span><span class="x">[</span><span class="n">r</span><span class="x">,</span><span class="n">p</span><span class="x">]</span><span class="o">=</span><span class="n">c</span><span class="o">*</span><span class="n">Vp</span><span class="x">[</span><span class="n">r</span><span class="x">]</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">Vq</span><span class="x">[</span><span class="n">r</span><span class="x">]</span>
            <span class="n">V</span><span class="x">[</span><span class="n">r</span><span class="x">,</span><span class="n">q</span><span class="x">]</span><span class="o">=</span><span class="n">s</span><span class="o">*</span><span class="n">Vp</span><span class="x">[</span><span class="n">r</span><span class="x">]</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">Vq</span><span class="x">[</span><span class="n">r</span><span class="x">]</span>
        <span class="k">end</span>
        <span class="k">return</span> <span class="n">A</span><span class="x">,</span><span class="n">V</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">A</span><span class="x">;</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>This function performs one sweep</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> Sweep</span><span class="x">(</span><span class="n">A</span><span class="x">;</span><span class="n">compV</span><span class="o">=</span><span class="n">false</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">Matrix</span><span class="x">{</span><span class="kt">Float64</span><span class="x">}(</span><span class="n">I</span><span class="x">,</span><span class="mi">1</span><span class="x">,</span><span class="mi">1</span><span class="x">))</span>
    <span class="n">n</span><span class="o">=</span><span class="n">size</span><span class="x">(</span><span class="n">A</span><span class="x">)[</span><span class="mi">1</span><span class="x">]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="k">in</span> <span class="mi">2</span><span class="x">:</span><span class="n">n</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="x">)</span> <span class="c">## Just over one triangle</span>
            <span class="k">if</span> <span class="n">compV</span><span class="o">==</span><span class="n">false</span>
                <span class="n">A</span><span class="o">=</span><span class="n">Rotate</span><span class="x">(</span><span class="n">A</span><span class="x">,</span><span class="n">ii</span><span class="x">,</span><span class="n">jj</span><span class="x">)</span>
            <span class="k">else</span>
                <span class="n">A</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">Rotate</span><span class="x">(</span><span class="n">A</span><span class="x">,</span><span class="n">ii</span><span class="x">,</span><span class="n">jj</span><span class="x">;</span><span class="n">computeV</span><span class="o">=</span><span class="n">true</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">V</span><span class="x">);</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="k">if</span> <span class="n">compV</span><span class="o">==</span><span class="n">false</span>
        <span class="k">return</span> <span class="n">A</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">A</span><span class="x">,</span><span class="n">V</span>
    <span class="k">end</span> 
<span class="k">end</span></code></pre></figure>

<p>Just creating some size of matrix</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">A</span><span class="x">,</span><span class="n">A0</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">5</span><span class="x">);</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="c">## keep evaluating for a couple iterations</span>
<span class="c">## watch how it changes</span>
<span class="n">A</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">Sweep</span><span class="x">(</span><span class="n">A</span><span class="x">;</span><span class="n">compV</span><span class="o">=</span><span class="n">true</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">V</span><span class="x">);</span>
<span class="n">display</span><span class="x">(</span><span class="n">roundmatrix</span><span class="x">(</span><span class="n">A</span><span class="x">,</span><span class="mf">1e-10</span><span class="x">))</span>
<span class="n">display</span><span class="x">(</span><span class="n">A</span><span class="x">)</span>
<span class="n">display</span><span class="x">(</span><span class="n">V</span><span class="x">)</span>
<span class="n">display</span><span class="x">(</span><span class="n">convergence</span><span class="x">(</span><span class="n">A</span><span class="x">))</span></code></pre></figure>

<p>This output is after several sweeps</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    5×5 Array{Float64,2}:
    2.75547   0.0     0.0      0.0        0.0    
    0.0      -1.0683  0.0      0.0        0.0    
    0.0       0.0     1.20611  0.0        0.0    
    0.0       0.0     0.0      0.734884   0.0    
    0.0       0.0     0.0      0.0       -1.48581

    5×5 Array{Float64,2}:
    2.75547       1.03898e-31  6.65473e-46   -1.20864e-52  -4.52913e-60 
    1.03898e-31  -1.0683       4.25018e-46   -2.9053e-69    1.37672e-80 
    6.65473e-46   4.25018e-46  1.20611        1.91399e-75   5.09273e-116
    -1.20864e-52  -2.9053e-69   1.91399e-75    0.734884      0.0         
    -4.52913e-60   1.37672e-80  5.09273e-116   0.0          -1.48581     

    5×5 Array{Float64,2}:
    0.702867    0.340672  -0.613045  0.0266825  -0.115695 
    -0.0750998   0.373435   0.239379  0.773343   -0.446705 
    0.597584   -0.208098   0.484961  0.308218    0.519041 
    -0.0642891  -0.754388  -0.459432  0.458861   -0.0716542
    -0.37296     0.363431  -0.347289  0.309317    0.715913 

    1.0794844600380612e-62
</code></pre>
</div>

<p>Compare the Optimized LAPLACK routine to your results</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">eigen</span><span class="x">(</span><span class="n">A0</span><span class="x">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>    Eigen{Float64,Float64,Array{Float64,2},Array{Float64,1}}
    eigenvalues:
    5-element Array{Float64,1}:
    -1.4858101513857376
    -1.068298321190819 
    0.7348837698415409
    1.206106933351782 
    2.755472216052164 
    eigenvectors:
    5×5 Array{Float64,2}:
    -0.115695   -0.340672  -0.0266825   0.613045   0.702867 
    -0.446705   -0.373435  -0.773343   -0.239379  -0.0750998
    0.519041    0.208098  -0.308218   -0.484961   0.597584 
    -0.0716542   0.754388  -0.458861    0.459432  -0.0642891
    0.715913   -0.363431  -0.309317    0.347289  -0.37296  
</code></pre>
</div>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="c">## A good check to make sure V is an orthonomal transformation</span>
<span class="n">roundmatrix</span><span class="x">(</span><span class="n">V</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">transpose</span><span class="x">(</span><span class="n">V</span><span class="x">)</span><span class="o">-</span><span class="n">A0</span><span class="x">,</span><span class="mf">1e-12</span><span class="x">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>      5x5 Array{Float64,2}:
       0.0  0.0  0.0  0.0  0.0
       0.0  0.0  0.0  0.0  0.0
       0.0  0.0  0.0  0.0  0.0
       0.0  0.0  0.0  0.0  0.0
       0.0  0.0  0.0  0.0  0.0
</code></pre>
</div>

<p>How long does it take to make a Sweep?
How much memory will the computation take?
This is dependent on how large the matrix is, and determines whether or not we
want to use this algorithm.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">A</span><span class="x">,</span><span class="n">A0</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">10</span><span class="x">);</span>
<span class="nd">@time</span> <span class="n">Sweep</span><span class="x">(</span><span class="n">A</span><span class="x">);</span>
<span class="n">A</span><span class="x">,</span><span class="n">A0</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">20</span><span class="x">);</span>
<span class="nd">@time</span> <span class="n">Sweep</span><span class="x">(</span><span class="n">A</span><span class="x">);</span>
<span class="n">A</span><span class="x">,</span><span class="n">A0</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">100</span><span class="x">);</span>
<span class="nd">@time</span> <span class="n">Sweep</span><span class="x">(</span><span class="n">A</span><span class="x">);</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>    0.000016 seconds (230 allocations: 32.594 KiB)
    0.000069 seconds (955 allocations: 196.188 KiB)
    0.008129 seconds (24.75 k allocations: 17.372 MiB, 27.48% gc time)
</code></pre>
</div>

<p>In addition to time per sweep, we need to know how many sweeps we need to run. So again we run it on a 10x10, 20x20, and 100x100. The efficiency of the algorithm would get a lot worse if we have to sweep the 100x100 a bunch of times.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">A10</span><span class="x">,</span><span class="n">Ap10</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">10</span><span class="x">);</span>
<span class="n">A20</span><span class="x">,</span><span class="n">Ap20</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">20</span><span class="x">);</span>
<span class="n">A100</span><span class="x">,</span><span class="n">Ap100</span><span class="x">,</span><span class="n">V</span><span class="o">=</span><span class="n">makeA</span><span class="x">(</span><span class="mi">100</span><span class="x">);</span>
<span class="n">nsweep</span><span class="o">=</span><span class="n">collect</span><span class="x">(</span><span class="mi">1</span><span class="x">:</span><span class="mi">7</span><span class="x">);</span>
<span class="n">conv10</span><span class="o">=</span><span class="n">zeros</span><span class="x">(</span><span class="mi">7</span><span class="x">)</span>
<span class="n">conv20</span><span class="o">=</span><span class="n">zeros</span><span class="x">(</span><span class="mi">7</span><span class="x">)</span>
<span class="n">conv100</span><span class="o">=</span><span class="n">zeros</span><span class="x">(</span><span class="mi">7</span><span class="x">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">nsweep</span>
    <span class="n">A10</span><span class="o">=</span><span class="n">Sweep</span><span class="x">(</span><span class="n">A10</span><span class="x">)</span>
    <span class="n">A20</span><span class="o">=</span><span class="n">Sweep</span><span class="x">(</span><span class="n">A20</span><span class="x">)</span>
    <span class="n">A100</span><span class="o">=</span><span class="n">Sweep</span><span class="x">(</span><span class="n">A100</span><span class="x">)</span>
    <span class="n">conv10</span><span class="x">[</span><span class="n">i</span><span class="x">]</span><span class="o">=</span><span class="n">convergence</span><span class="x">(</span><span class="n">A10</span><span class="x">)</span>
    <span class="n">conv20</span><span class="x">[</span><span class="n">i</span><span class="x">]</span><span class="o">=</span><span class="n">convergence</span><span class="x">(</span><span class="n">A20</span><span class="x">)</span>
    <span class="n">conv100</span><span class="x">[</span><span class="n">i</span><span class="x">]</span><span class="o">=</span><span class="n">convergence</span><span class="x">(</span><span class="n">A100</span><span class="x">)</span>
<span class="k">end</span>

<span class="x">[</span><span class="n">nsweep</span> <span class="n">conv10</span><span class="o">/</span><span class="mi">10</span> <span class="n">conv20</span><span class="o">/</span><span class="mi">20</span> <span class="n">conv100</span><span class="o">/</span><span class="mi">100</span><span class="x">]</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>    7×4 Array{Float64,2}:
    1.0  1.74923       2.64638      14.7488     
    2.0  0.0945499     0.422473      2.80609    
    3.0  0.000314227   0.0162891     0.399226   
    4.0  6.31792e-10   1.09268e-5    0.0356924  
    5.0  3.62048e-22   1.18607e-11   0.000598666
    6.0  9.38425e-48   7.94096e-26   3.28477e-7 
    7.0  1.14895e-112  1.23362e-55   6.11775e-13
</code></pre>
</div>

<p>Well, so we’ve seen how to do one form of exact diagonalization that works, but doesn’t scale very well up to 100x100 matrices.  So stay tuned for the Householder method, hopefully coming up soon.</p>

<p>Until then, happy computing :)</p>

  </article>

</div>

      </div>
    </div>

    <div class="comment">
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'M4julia'; // required: replace example with your forum shortname
  var disqus_identifier = "/Jacobi-Transformation.html";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>

    <footer class="site-footer">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>


  <div class="wrapper">

    <h2 class="footer-heading">Metals, Magnets, and Miscellaneous Materials</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Metals, Magnets, and Miscellaneous Materials</li>
          <li><a href="mailto:chrissie.c.l@gmail.com">chrissie.c.l@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/albi3ro">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">albi3ro</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/PyrochloreLee">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">PyrochloreLee</span>
            </a>
          </li>
          
          <li>
              <div class="fb-share-button"
               data-href="/M4/Jacobi-Transformation.html" data-layout="button_count"></div>

          </li>
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Blog Introduction to Computational Condensed Matter Physics</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-70984222-1', 'auto');
  ga('send', 'pageview');

</script>
